@using ERP_Component_DAL.Models
@{
	ViewBag.Title = "Vendor Quotation";
	Layout = "~/Views/Shared/_LayoutINV.cshtml";
}
@model Vendor

<link rel="stylesheet" href="~/css/Product.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
	.styled-checkbox {
		width: 18px;
		height: 18px;
		accent-color: #28a745;
		cursor: pointer;
	}
	.overlay {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.6);
		justify-content: center;
		align-items: center;
		z-index: 9999;
	}
	.Popuptable {
		background: #fff;
		padding: 20px;
		border-radius: 10px;
		width: 80%;
		max-height: 80%;
		overflow-y: auto;
	}
	.close-btn {
		position: absolute;
		top: 10px;
		right: 20px;
		color: #fff;
		font-size: 25px;
		cursor: pointer;
	}
</style>

<!-- Vendor Cards -->
<div class="row row-cols-1 row-cols-md-3 g-4 p-5">
    @for (int i = 0; i < Model.lists.Count; i++)
    {
        var v = Model.lists[i];
        <div class="col">
			<div class="card vendor-card" onclick="GetVenderItemData('@v.vendorId')" style="width: 18rem; cursor: pointer;">
				<i class="fa fa-user w-100 d-flex justify-content-center align-items-center flex-column mt-1" style="height:75px;font-size:35px">
					<p>@v.vendorName</p>
				</i>
				<div class="card-body">
					<p class="card-text">Amount: <span>@v.amount.ToString("0.00")</span></p>
					<p class="card-text">Discount Amount: <span>@v.discountAmount.ToString("0.00")</span></p>
					<p class="card-text">Final Amount: <span>@v.finalAmount.ToString("0.00")</span></p>
					<p class="card-text">Advance Amount: <span>@v.advancedAmount.ToString("0.00")</span></p>
					<p class="card-text">Delivery Terms: <span>@v.deliveryTerms <small>Days</small></span></p>
					<p class="card-text">Credit Period: <span>@v.creditPeriod <small>Days</small></span></p>
				</div>
			</div>
        </div>
    }
</div>

<!-- Popup Table Overlay -->
<div class="overlay">
	<span class="close-btn" onclick="$('.overlay').hide()">&times;</span>
	<div class="Popuptable">
		<table>
			<thead>
				<tr>
					<th>S.No</th>
					<th>Item Name</th>
					<th>Unit Price</th>
				</tr>
			</thead>
			<tbody id="geeks"></tbody>
		</table>
	</div>
</div>

<!-- AJAX Function to Get Vendor Items -->
<script>
		function GetVenderItemData(vendorId) {
		console.log("Vendor GUID:", vendorId); // ✅ Debug log

		$.ajax({
			url: '/Manager/GetVendorItems',
			type: 'POST',
			data: { VenderId: vendorId }, // Match parameter name
			success: function (data) {
				console.log("Data received:", data);
				let tableBody = $("#geeks");
				tableBody.empty();

				if (data && data.length > 0) {
					data.forEach((item, index) => {
						tableBody.append(`
							<tr>
								<td>${index + 1}</td>
								<td>${item.itemName}</td>
								<td>${item.unitPrice}</td>
							</tr>
						`);
					});
				} else {
					tableBody.append(`<tr><td colspan="3">No items found</td></tr>`);
				}

				$(".overlay").css("display", "flex");
			},
			error: function (xhr, status, error) {
				console.error("Error:", error);
				alert("Failed to load items.");
			}
		});
	}

</script>
